# Симулятор Нефтяного Месторождения

Это простой 2D симулятор двухфазной (нефть и вода) фильтрации в пористой среде, написанный на C++. Он использует схему IMPES (неявная по давлению, явная по насыщенности).

## Физика и Численные Методы

Симулятор решает стандартные уравнения двухфазной фильтрации в рамках модели "черной нефти".

### Основные уравнения

Уравнение для давления выводится из закона сохранения масс для обеих фаз и решается неявно:
$$
\nabla \cdot \left( \lambda_t \mathbf{K} \nabla p \right) + q_t = \phi c_t \frac{\partial p}{\partial t}
$$

Уравнение для насыщенности решается явно после того, как поле давления становится известно:
$$
\phi \frac{\partial S_w}{\partial t} + \nabla \cdot \left( \mathbf{v}_t f_w \right) + q_w = 0
$$

Где:
- $ \lambda_t = \lambda_w + \lambda_o $ - общая подвижность, где $ \lambda_p = k_{rp} / \mu_p $ - подвижность фазы $p$.
- $ \mathbf{K} $ - тензор проницаемости.
- $ p $ - давление.
- $ q_t $ - суммарный источниковый член от скважин.
- $ \phi $ - пористость.
- $ c_t $ - общая сжимаемость (порода + флюиды).
- $ S_w $ - водонасыщенность.
- $ \mathbf{v}_t $ - суммарная скорость Дарси.
- $ f_w $ - функция распределения потока для воды.
- $ q_w $ - источниковый член для воды.

### Модель скважин

Скважины моделируются с использованием стандартной **модели скважин Письмена (Peaceman)**. Источниковый/стоковый член для скважины рассчитывается как:
$$
q = WI \cdot \lambda \cdot (p_{bh} - p_{block})
$$
Где $WI$ - это индекс скважины, вычисляемый по формуле:
$$
WI = \frac{2 \pi k h}{\ln(r_e / r_w)}
$$
с эффективным радиусом $ r_e = 0.14 \sqrt{\Delta x^2 + \Delta y^2} $.

### Другие модели

- **Относительные фазовые проницаемости**: Модель Кори.
- **Вязкость флюидов**: Моделируется как функция давления.
- **Линейный решатель**: BiCGSTAB из библиотеки Eigen для уравнения давления.
- **Распараллеливание**: Цикл обновления насыщенности распараллелен с использованием OpenMP.

## Зависимости

-   Компилятор C++17 (например, GCC, Clang)
-   CMake (версия 3.11 или выше)
-   Git
-   Python 3 с библиотеками `matplotlib` и `numpy` для визуализации.
    ```
    pip install matplotlib numpy
    ```

## Сборка

Проект использует CMake для сборки.

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL_репозитория>
    cd oil-simulator
    ```

2.  **Создайте директорию для сборки:**
    ```bash
    mkdir build
    cd build
    ```

3.  **Запустите CMake и соберите проект:**
    ```bash
    cmake ..
    make
    ```
    Это создаст два исполняемых файла в директории `build`: `simulator` и `test_runner`.

## Запуск

### Запуск симуляции

Основной исполняемый файл `simulator` принимает один аргумент: путь к файлу с параметрами.

Находясь в директории `build`, выполните:
```bash
./simulator ../data/five_spot.dat
```
Эта команда:
1.  Запустит симуляцию с параметрами из файла `five_spot.dat`.
2.  Сохранит итоговое давление и насыщенность для каждой ячейки в файл `results.txt` в корневой директории проекта.
3.  Автоматически вызовет Python-скрипт для визуализации.
4.  Создаст файлы `pressure_map.png` и `saturation_map.png` в корневой директории проекта.

### Запуск тестов

Исполняемый файл `test_runner` запускает все скомпилированные юнит-тесты.

Находясь в директории `build`, выполните:
```bash
./test_runner
```
Эта команда выполнит тесты и сообщит об их успешном или неуспешном прохождении.

## Структура Проекта

- `src/`: Исходный код и заголовочные файлы C++.
- `data/`: Файлы с параметрами для сценариев симуляции.
- `python/`: Python-скрипт для визуализации.
- `tests/`: Исходный код для юнит-тестов.
- `build/`: Директория для сборки (создается вами).
- `results.txt`: Основной файл с результатами (создается после запуска).
- `*.png`: Файлы с визуализацией (создаются после запуска).
- `CMakeLists.txt`: Главный сборочный скрипт CMake.
- `README.md`: Документация на английском.
- `README.ru.md`: Эта документация на русском. 